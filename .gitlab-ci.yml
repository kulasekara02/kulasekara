image: python:3.11

# Prevent submodule checkout (avoid fetching unreachable external hosts)
variables:
  GIT_SUBMODULE_STRATEGY: "none"

stages:
  - lint
  - test
  - build
  - deploy

# Common setup for all jobs
before_script:
  - pip install --upgrade pip

lint:
  stage: lint
  script:
    - pip install flake8
    - flake8 app || true

test:
  stage: test
  script:
    - pip install -r app/requirements.txt pytest
    - pytest -q

build:
  stage: build
  script:
    - pip install -r app/requirements.txt pyinstaller
    - echo "Build completed successfully for GitLab CI/CD Lab - Vihanga (port 40208)"

deploy:
  stage: deploy
  when: manual
  script:
    - echo "Deploy step (simulation only) for  on port 40208"
